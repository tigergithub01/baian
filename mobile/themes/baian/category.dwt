<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>{$page_title}</title>
	<meta name="keywords" content="{$keywords}" />
	<meta name="description" content="{$description}" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	

</head>
<body>
	<!-- 搜索导航 -->
	<!-- #BeginLibraryItem "/library/page_header.lbi" --><!-- #EndLibraryItem -->

	<!-- 主页面 -->
	<section id="main" data-role="page" id="one">

		<header id="head">
			<a href="javascript:history.back(-1);" class="back-btn"></a>
			<h2>商品分类</h2>
		</header>

		<div class="w-box">
		    <div id="tabBox1" class="tabBox">
				<div class="hd">
					<ul>
						<li class="on"><a href="javascript:void(0)">默认</a></li>
						<li><a href="javascript:void(0)">销量</a></li>
						<li><a href="javascript:void(0)">价格</a></li>
						<li><a href="javascript:void(0)">促销</a></li>
						<li><a href="javascript:void(0)">积分</a></li>
						<li><a href="javascript:void(0)">红包</a></li>
						<li id="filter_tab"><a href="javascript:void(0)">筛选</a></li>
					</ul>
				</div>
				<div class="bd" id="tabBox1-bd">
					<div id="goods_list" class="con">
						<!-- #BeginLibraryItem "/library/goods_list.lbi" --><!-- #EndLibraryItem -->
						
						
					</div>
				</div>
			</div>
			<!-- <a href="#sect_filter" data-direction="reverse" data-transition="slide" class="">page</a> -->
		</div>
		
		  <input type="hidden" id="category" name="category" value="{$category}" />
		  <input type="hidden"  name="display" value="{$pager.display}" id="display" />
		  <input type="hidden" id="brand" name="brand" value="{$brand}" />
		  <input type="hidden" id="price_min" name="price_min" value="{$price_min}" />
		  <input type="hidden" id="price_max" name="price_max" value="{$price_max}" />
		  <input type="hidden" id="filter_attr" name="filter_attr" value="{$filter_attr}" />
		  <input type="hidden" id="filter_ext" name="filter_ext" value="{$filter_ext}" />
		  <input type="hidden" id="page" name="page" value="{$pager.page}" />
		  <input type="hidden" id="sort" name="sort" value="{$pager.sort}" />
		  <input type="hidden" id="order" name="order" value="{$pager.order}" />
		  <input type="hidden" id="size" name="size" value="{$pager.size}" /> 
		  <input type="hidden" id="record_count" name="record_count" value="{$pager.record_count}" />
		  <input type="hidden" id="page_count" name="page_count" value="{$pager.page_count}" /> 
		  
		<div class="h"></div>
	</section>
	
	<section id="sect_filter"  style="float: left;position: absolute;top: 0;right: 0;width:0;height: 100%;z-index: 2000;display: inline;overflow: hidden;">
		<header id="head">
		<a href="javascript:void(0)" class="back-btn" onclick="slideOff()"></a>
			<h2 >过滤条件</h2>
		</header>
		<div class="w-box" style="height: 100%;">
			XXXX
		</div>
	</section>
	
	

	<!-- 底部主导航 -->
	<!-- #BeginLibraryItem "/library/navi.lbi" --><!-- #EndLibraryItem -->

	<script type="text/javascript" src="js/TouchSlide.js"></script>
	<script type="text/javascript">
	/* TouchSlide( { slideCell:"#tabBox1",
		startFun:function( i,c,s ){ 
			console.debug(i);
			console.debug(c);
			console.debug(s);
			if(i==6){
				slideOn();
			}
			}, 
		endFun:function(i){ //高度自适应
			// var bd = document.getElementById("tabBox1-bd");
			//bd.parentNode.style.height = bd.children[i].children[0].offsetHeight+"px";
			//if(i>0)bd.parentNode.style.transition="200ms";//添加动画效果 
		}

	} ); */
	
	
	
	function slideOff(){
		 /* $("#sect_filter").animate({ 
			    width: "90%",
			    height: "100%", 
			    fontSize: "10em", 
			    borderWidth: 10
			  }, 1000 ); */
			  //$("#sect_filter").fadeOut();
			  $("#sect_filter").animate({"width":"0"});
			  //$("#sect_filter").hide();
			  //$("#sect_filter").slideToggle();
			  //$("#sect_filter").fadeTo();
		
		//$("#sect_filter").slideDown();
		
	}
	
	function slideOn(){
		//$("#sect_filter").fadeIn();	
		//$("#sect_filter").slideUp();
		$("#sect_filter").animate({"width":$(window).width()},500);
		//$("#sect_filter").slideToggle();
	}
	
	$(function(){
        $(window).scroll(function() {
            //$(document).scrollTop() 获取垂直滚动的距离
            //$(document).scrollLeft() 这是获取水平滚动条的距离
            if ($(document).scrollTop() <= 0) {
                //alert("滚动条已经到达顶部为0");
            }

            if ($(document).scrollTop() >= $(document).height() - $(window).height()) {
                //alert("滚动条已经到达底部为" + $(document).scrollTop());
                
            	more_goods_list();
            }
        });
        
        //slideOn();
        
        $(".tabBox .hd ul li").click(function(){
        	$(".tabBox .hd ul li").removeClass("on");
        	$(this).addClass("on");
        	if($(this).prop("id")=='filter_tab'){
        		slideOn();
        	}
        });
        
        //图片延迟加载
        $("img.lazy").lazyload({effect: "fadeIn"});
    });
	
	
	function more_goods_list(){
		var category = $("#category").val();
    	var brand = $("#brand").val();
    	var price_min = $("#price_min").val();
    	var price_max = $("#price_max").val();
    	var filter_attr = $("#filter_attr").val();
    	var filter_ext = $("#filter_ext").val();
    	var sort = $("#sort").val();
    	var order = $("#order").val();
    	var page = $("#page").val();
    	var size = $("#size").val();
    	var record_count = $("#record_count").val();
    	var page_count = $("#page_count").val();
    	
    	if(page>=page_count){
    		//已经到达最后一页
    		return;
    	}
    	page = parseInt(page)+1;
    	
    	var filter_con = {"category":category, "brand":brand, 
    		"price_min":price_min, "price_max":price_max, 
    		"filter_attr": filter_attr,"filter_ext":filter_ext,
    		"sort":sort, "order":order,"page":page,"size":size,
    		"record_count":record_count,"page_count":page_count
    		}
    	get_goods_list(filter_con)
	}
	
	
	function get_goods_list(filter_con){
		//var category_url = "category-340-b0.html";
		
		
    	
    	/* if(type=='brand'){
    		brand="";
    		var $checkedlist = $(".brand input[type='checkbox']:checked");
    		if($checkedlist.length==0){
    			return;
    		}
    		$checkedlist.each(function(index,v){
    			brand += $(this).val();
    			if(index<($checkedlist.length-1)){
    				brand += ",";
    			}	
	        }); 
    	}else if(type=='price_grade'){
    		
    	}else if(type=='attr'){
    		checked_attr="";
    		var $checkedlist = $(".attr_"+attr_index+" input[type='checkbox']:checked");
    		if($checkedlist.length==0){
    			return;
    		}
    		$checkedlist.each(function(index,v){
    			checked_attr += $(this).val();
    			if(index<($checkedlist.length-1)){
    				checked_attr += ",";
    			}	
	        });
    		
    		//先根据长度格式化为0.0.0.0格式
    		var filter_attr_count = {$filter_attr_count};
    		var filter_attr = '{$filter_attr}';
    		if(filter_attr=='0' && filter_attr_count > 0){
    			filter_attr = "";
    			for(var i=0;i<filter_attr_count;i++){
        			filter_attr +=('0');
        			if(i<(filter_attr_count-1)){
        				filter_attr += ".";
        			}
        		}
    		}
    		
    		
    		//再重新赋值
    		var filter_attr_array = filter_attr.split('.');
    		filter_attr="";
    		for(var i=0;i<filter_attr_array.length;i++){
    			if(attr_index==i){
    				filter_attr +=(checked_attr);
    			}else{
    				filter_attr +=(filter_attr_array[i]);
    			}
    			if(i<(filter_attr_count-1)){
    				filter_attr += ".";
    			}
    		}
    		console.debug(filter_attr);
    	} */
    	
    	//
		$.ajax({     
    	    url: "category.php",
    	    type:'post',  
    	    data:{'is_ajax_fetch':'1','id':filter_con.category,'brand':filter_con.brand,
    	    	'price_min':filter_con.price_min,'price_max':filter_con.price_max,
    	    	'filter_attr':filter_con.filter_attr,'filter_ext':filter_con.filter_ext,
    	    	'sort':filter_con.sort,'order':filter_con.order,'page':filter_con.page,'size':filter_con.size,
    	    	'record_count':filter_con.record_count,'page_count':filter_con.page_count},  
    	    dataType:'json', 
    	    async :true, 
    	    error:function(){ 
    	    	//alert('更新出错！');
    	    },     
    	    success:function(data){ 
    	    	//console.debug(data);
    	    	if(data.error==""){
    	    		//append data into area
    	    		$("#goods_list").append(data.content);
    	    		
    	    		//update condition
    	    		$("#category").val(filter_con.category);
    	        	$("#brand").val(filter_con.brand);
    	        	$("#price_min").val(filter_con.price_min);
    	        	$("#price_max").val(filter_con.price_max);
    	        	$("#filter_attr").val(filter_con.filter_attr);
    	        	$("#filter_ext").val(filter_con.filter_ext);
    	        	$("#sort").val(filter_con.sort);
    	        	$("#order").val(filter_con.order);
    	        	$("#page").val(filter_con.page);
    	        	$("#size").val(filter_con.size);
    	        	$("#record_count").val(filter_con.record_count);
    	        	$("#page_count").val(filter_con.page_count);
    	    	}
    	    }  
    	});
	}
	
	
	
	</script>
	
	<script src="/mobile/themes/baian/js/jquery.lazyload.js?v=1.9.1"></script>
</body>
</html>