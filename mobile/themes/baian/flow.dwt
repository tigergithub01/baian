<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>{$page_title}</title>
	<meta name="keywords" content="{$keywords}" />
	<meta name="description" content="{$description}" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<script type="text/javascript" src="/js/shopping_flow.js"></script>
	<!-- 公用样式与脚本 -->
	<!-- #BeginLibraryItem "/library/page_common.lbi" --><!-- #EndLibraryItem -->
</head>
<body>
<!-- <script type="text/javascript" src="themes/baian/js/jqm1.7.js"></script> -->
	<!-- 搜索导航 -->
	<!-- #BeginLibraryItem "/library/page_header.lbi" --><!-- #EndLibraryItem -->

<!-- #购物车界面start -->
  <!-- {if $step eq "cart"} -->
	
	
  <div class="c"></div>
	<div id="bd">
		<div class="wp2">
			
			  {* 包含脚本文件 *}
			  {insert_scripts files='showdiv.js'}
			  <script type="text/javascript">
			  {foreach from=$lang.password_js item=item key=key}
			    var {$key} = "{$item}";
			  {/foreach}
			   <!--add by wanggz可以从购物车中选择商品购买功能-->
			   
			   
			  function selectAll(obj, chk)
			{
			  if (chk == null)
			  {
			      chk = 'checkboxes';
			  }
			  var elems = obj.form.getElementsByTagName("INPUT");
			  for (var i=0; i < elems.length; i++)
			  {
			    if (elems[i].name == chk || elems[i].name == chk + "[]")
			    {
			      elems[i].checked = obj.checked;
			    }
			  }
			} <!--add by wanggz可以从购物车中选择商品购买功能end--> 
			 
			  </script>
  
  
		
		<div id="ECS_CART_GOODS">
		<!-- #BeginLibraryItem "/library/cart_goods.lbi" --><!-- #EndLibraryItem --> 
		</div>
	
		<!-- 底部主导航 -->
	<!-- #BeginLibraryItem "/library/navi.lbi" --><!-- #EndLibraryItem -->
		
            <script type="text/javascript">
            $(function(){
            	
            	//自动选中，反选“全部”复选框 
            	autoCheckAll();
            	
            	/***全部选择**/
	            $('.selcall').click(function(){
	            	if($(this).attr("checked")) {     
	            		$(".check_goods").attr("checked",'true');
	            		$(".selcall").attr("checked",'true');
	            	} else{     
	            		$(".check_goods").removeAttr("checked"); 
	            		$(".selcall").removeAttr("checked"); 
	            	}    
	            	
	            	//选中，反选商品更新购物车
	            	check_all_cart_goods(($(this).attr("checked"))?1:0);
	        	});
				
	            /***选择商品**/
	        	$('.check_goods').click(function(){
	        		//选中，反选商品更新购物车
	        		check_cart_goods($(this).val(),($(this).attr("checked"))?1:0);
	        		
	        		
	        		autoCheckAll();
	        	});
            });
            
            
            /**
            	自动选中，反选“全部”复选框 
            **/
            
            function autoCheckAll(){
            	var allChecked  = true;	
        		$.each($('.check_goods'),function(i,v){
        			if(!$(v).attr("checked")){
        				allChecked = false;
        				return false;
        			}
        		});
        		if(allChecked){
        			$(".selcall").attr("checked",'true');
        		}else{
        			$(".selcall").removeAttr("checked"); 
        		}	
            }
            
            /***选中，反选购物车内的商品***/
            function check_cart_goods(rec_id,is_checked){
            	$.ajax({     
            	    url:'flow.php?step=check_cart_goods',     
            	    type:'post',  
            	    dataType:'json', 
            	    data:{'rec_id':rec_id,'is_checked':is_checked},     
            	    async :true, 
            	    error:function(){ 
            	    	//alert('更新出错！');
            	    },     
            	    success:function(data){ 
            		    if(data.status==1){
            		    	$("#total_goods_number").text(data.content.total.goods_number);
            		    	$("#total_goods_amount").text(data.content.total.goods_price);
            		    }else{
            		    	alert(data.message);
            		    }
            	    }  
            	}); 
            }
            
            /***选中，反选购物车内的全部商品***/
            function check_all_cart_goods(is_checked){
            	$.ajax({     
            	    url:'flow.php?step=check_all_cart_goods',     
            	    type:'post',  
            	    dataType:'json', 
            	    data:{'is_checked':is_checked},     
            	    async :true, 
            	    error:function(){ 
            	    	//alert('更新出错！');
            	    },     
            	    success:function(data){ 
            		    if(data.status==1){
            		    	$("#total_goods_number").text(data.content.total.goods_number);
            		    	$("#total_goods_amount").text(data.content.total.goods_price);
            		    }else{
            		    	alert(data.message);
            		    }
            	    }  
            	}); 
            }
            
            /***更新购物车内某商品的数量***/
            function flow_update_cart_goods(rec_id,goods_number){
            	$.ajax({     
            	    url:'flow.php?step=flow_update_cart_goods',     
            	    type:'post',  
            	    dataType:'json', 
            	    data:{'rec_id':rec_id,'goods_number':goods_number},     
            	    async :true, 
            	    error:function(){ 
            	    	//alert('更新出错！');
            	    },     
            	    success:function(data){ 
            		    if(data.status==1){
            		    	/*
            		    	$.each(data.content.goods_list,function(i,v){
                    			if(v.rec_id == rec_id){
                    				$("#number"+rec_id).val(v.goods_number);
                    				$("#sub_total_"+rec_id).text(v.subtotal);
                    				return false;
                    			}
                    		});
            		    	
            		    	$("#total_goods_number").text(data.content.total.goods_number);
            		    	$("#total_goods_amount").text(data.content.total.goods_price);
            		    	*/
            		    	//更新成功直接刷新购物车
            		    	refresh_cart_goods();
            		    	
            		    }else{
            		    	alert(data.message);
            		    	//更新出错，还原本行数据
            		    	if(data.content!=null){
            		    		if(rec_id!=null){
            		    			$.each(data.content.goods_list,function(i,v){
                            			if(v.rec_id == rec_id){
                            				$("#number"+rec_id).val(v.goods_number);
                            				$("#sub_total_"+rec_id).text(v.subtotal);
                            				return false;
                            			}
                            		});
            		    		}
                		    	$("#total_goods_number").text(data.content.total.goods_number);
                		    	$("#total_goods_amount").text(data.content.total.goods_price);
            		    	}
            		    }
            	    }  
            	}); 
            }
            
            /**
            	刷新购物车
            **/
            function refresh_cart_goods(rec_id){
            	$.ajax({     
            	    url:'flow.php?step=cart&is_ajax=1',     
            	    type:'post',  
            	    dataType:'json', 
            	    data:{},     
            	    async :true, 
            	    error:function(){ 
            	    	//alert('更新出错！');
            	    },     
            	    success:function(data){ 
            		    if(data.status==1){
            		    	$("#ECS_CART_GOODS").html(data.content);
            		    }else{
            		    	window.location.href = 'flow.php?step=cart';
            		    }
            	    }  
            	}); 
            }
            
            /***
            	获取购物车内的商品信息
            */
            function get_cart_goods(rec_id){
            	$.ajax({     
            	    url:'flow.php?step=get_cart_goods',     
            	    type:'post',  
            	    dataType:'json', 
            	    data:{},     
            	    async :true, 
            	    error:function(){ 
            	    	//alert('更新出错！');
            	    },     
            	    success:function(data){ 
            		    if(data.status==1){
            		    	if(data.content!=null){
            		    		if(rec_id!=null){
            		    			$.each(data.content.goods_list,function(i,v){
                            			if(v.rec_id == rec_id){
                            				$("#sub_total_"+rec_id).text(v.subtotal);
                            				return false;
                            			}
                            		});
            		    		}
                		    	$("#total_goods_number").text(data.content.total.goods_number);
                		    	$("#total_goods_amount").text(data.content.total.goods_price);
            		    	}
            		    }else{
            		    	//alert(data.message);
            		    }
            	    }  
            	}); 
            }
            
            /**去结算**/
            function checkout()
			{
            	//根据name查找选中的checkbox
				 var checked_list = $("input[name='checkboxes[]']:checked");
				 if(checked_list.length==0){
					 alert('请先选择您要结算的商品!');
					 return false;
				 }
				 
            	document.formCart.step.value='checkout';
				//formCart.submit();
				document.forms['formCart'].submit();
				//$("#formCart").submit();
				//alert(document.getElementById('formCart').submit());
			}
            
            /**更新购物车**/
			function update_cart()
			{
				document.formCart.step.value='update_cart';
				document.getElementById('formCart').submit();
			}
            
            /**更新购物车-减少商品数量***/
			function goods_cut($val){
				var num_val=document.getElementById('number'+$val);
				var new_num=num_val.value;
				if(isNaN(new_num)){alert('请输入数字');return false}
				var Num = parseInt(new_num);
				if(Num>1){
					Num=Num-1;
					flow_update_cart_goods($val,Num);
				}else{
					num_val.value=Num;
				}
			}
			
			/***更新购物车-增加商品数量**/
			function goods_add($val){
				var num_val=document.getElementById('number'+$val);
				var new_num=num_val.value;
				if(isNaN(new_num)){alert('请输入数字');return false}
				var Num = parseInt(new_num);
				Num=Num+1;
				num_val.value=Num;
				//document.getElementById('updatecart').click();
				flow_update_cart_goods($val,Num);
			}
			
			/**直接改变购物车中商品数量**/
			function change_goods_number(rec_id){
				var goods_number = $("#number"+rec_id).val();
				
				if(isNaN(goods_number)){
					//alert('请输入数字');
					$("#number"+rec_id).val("1");
				}
				
				if($("#number"+rec_id).val()<=1){
					$("#number"+rec_id).val("1");
				}
				flow_update_cart_goods(rec_id,$("#number"+rec_id).val());
			}
			
			 /*批量删除购物车中商品信息***/
			function drop_goods_batch(){
				 //根据name查找选中的checkbox
				 var checked_list = $("input[name='checkboxes[]']:checked");
				 if(checked_list.length==0){
					 alert('请先选择您要操作的商品!');
					 return false;
				 }
				 
				if(!confirm('您确实要把选中的商品移出购物车吗?')){
					return false;
				}
				$("#step").val('drop_goods_batch');
				$("#formCart").submit();
			}
			
			 /*批量删除购物车中商品信息***/
			function drop_to_collect_batch(){
				//根据name查找选中的checkbox
				 var checked_list = $("input[name='checkboxes[]']:checked");
				 if(checked_list.length==0){
					 alert('请先选择您要操作的商品!');
					 return false;
				 }
				 
				if(!confirm('您确实要把选中的商品移出购物车吗?')){
					return false;
				}
				$("#step").val('drop_to_collect_batch');
				$("#formCart").submit();
			}
			
            
            
			
            /*
            var scrollPic_01 = new ScrollPic();
			scrollPic_01.scrollContId   = "rollphoto1"; //内容容器ID
			scrollPic_01.arrLeftId      = "recommend-left";//左箭头ID
			scrollPic_01.arrRightId     = "recommend-rigth"; //右箭头ID
	
			scrollPic_01.frameWidth     = 878;//显示框宽度
			scrollPic_01.pageWidth      = 874; //翻页宽度
	
			scrollPic_01.speed          = 10; //移动速度(单位毫秒，越小越快)
			scrollPic_01.space          = 10; //每次移动像素(单位px，越大越快)
			scrollPic_01.autoPlay       = true; //自动播放
			scrollPic_01.autoPlayTime   = 3; //自动播放间隔时间(秒)
	
			scrollPic_01.initialize(); //初始化
			*/
			
			
			
         </script>
		
       <!-- {if $smarty.session.user_id gt 0} -->
       {insert_scripts files='transport1.js'}
       <script type="text/javascript" charset=utf-8>
        function collect_to_flow(goodsId)
        {
          var goods        = new Object();
          var spec_arr     = new Array();
          var fittings_arr = new Array();
          var number       = 1;
          goods.spec     = spec_arr;
          goods.goods_id = goodsId;
          goods.number   = number;
          goods.parent   = 0;
          Ajax.call('flow.php?step=add_to_cart', 'goods=' + goods.toJSONString(), collect_to_flow_response, 'POST', 'JSON');
        }
        function collect_to_flow_response(result)
        {
          if (result.error > 0)
          {
            // 如果需要缺货登记，跳转
            if (result.error == 2)
            {
              if (confirm(result.message))
              {
                location.href = 'user.php?act=add_booking&id=' + result.goods_id;
              }
            }
            else if (result.error == 6)
            {
              openSpeDiv(result.message, result.goods_id);
            }
            else
            {
              alert(result.message);
            }
          }
          else
          {
            location.href = 'flow.php';
          }
        }
      </script>
 	<!-- {/if} -->
  <!-- {/if} -->
  <!-- #购物车界面end -->
		
		  <!-- #商品配件start -->	
		  <!-- {if $fittings_list} 商品配件 -->
		  {insert_scripts files='transport1.js'}
		  <script type="text/javascript" charset=utf-8>
		  function fittings_to_flow(goodsId,parentId)
		  {
		    var goods        = new Object();
		    var spec_arr     = new Array();
		    var number       = 1;
		    goods.spec     = spec_arr;
		    goods.goods_id = goodsId;
		    goods.number   = number;
		    goods.parent   = parentId;
		    Ajax.call('flow.php?step=add_to_cart', 'goods=' + goods.toJSONString(), fittings_to_flow_response, 'POST', 'JSON');
		  }
		  function fittings_to_flow_response(result)
		  {
		    if (result.error > 0)
		    {
		      // 如果需要缺货登记，跳转
		      if (result.error == 2)
		      {
		        if (confirm(result.message))
		        {
		          location.href = 'user.php?act=add_booking&id=' + result.goods_id;
		        }
		      }
		      else if (result.error == 6)
		      {
		        openSpeDiv(result.message, result.goods_id, result.parent);
		      }
		      else
		      {
		        alert(result.message);
		      }
		    }
		    else
		    {
		      location.href = 'flow.php';
		    }
		  }
		  </script>
		
		
		  <div class="block" >
		    <div class="flowBox modd2">
		    <span class="lt"></span><span class="lb"></span><span class="rt"></span><span class="rb"></span>
		    <h6><span>{$lang.goods_fittings}</span></h6>
		    <form action="flow.php" method="post">
		        <div class="flowGoodsFittings clearfix">
		          <!-- {foreach from=$fittings_list item=fittings} -->
		            <ul class="clearfix">
		              <li class="goodsimg">
		                <a href="{$fittings.url}" target="_blank"><img src="{$fittings.goods_thumb}" alt="{$fittings.name|escape:html}" class="B_blue" /></a>
		              </li>
		              <li>
		                <a href="{$fittings.url}" target="_blank" title="{$fittings.goods_name|escape:html}" class="f6">{$fittings.short_name|escape:html}</a><br />
		                {$lang.fittings_price}<font class="f1">{$fittings.fittings_price}</font><br />
		                {$lang.parent_name}{$fittings.parent_short_name}<br />
		                <a href="javascript:fittings_to_flow({$fittings.goods_id},{$fittings.parent_id})"><img src="images/bnt_buy.gif" alt="{$lang.collect_to_flow}" /></a>
		              </li>
		            </ul>
		          <!-- {/foreach} 循环商品配件结束 -->
		        </div>
		    </form>
		    </div>
		  </div>
		  <div class="blank5"></div>
		  <!-- {/if} -->
		  <!-- #商品配件end -->	
		  
		
		 <!-- #优惠活动start -->		
		  <!-- {if $favourable_list} 优惠活动 -->
		  <div class="block">
		    <div class="flowBox modd2">
		     <span class="lt"></span><span class="lb"></span><span class="rt"></span><span class="rb"></span>
		    <h6><span>{$lang.label_favourable}</span></h6>
		        <!-- {foreach from=$favourable_list item=favourable} -->
		        <form action="flow.php" method="post">
		          <table width="100%" align="center" border="0" cellpadding="5" cellspacing="1" bgcolor="#dddddd">
		            <tr>
		              <td align="right" bgcolor="#ffffff">{$lang.favourable_name}</td>
		              <td bgcolor="#ffffff"><strong>{$favourable.act_name}</strong></td>
		            </tr>
		            <tr>
		              <td align="right" bgcolor="#ffffff">{$lang.favourable_period}</td>
		              <td bgcolor="#ffffff">{$favourable.start_time} --- {$favourable.end_time}</td>
		            </tr>
		            <tr>
		              <td align="right" bgcolor="#ffffff">{$lang.favourable_range}</td>
		              <td bgcolor="#ffffff">{$lang.far_ext[$favourable.act_range]}<br />
		              {$favourable.act_range_desc}</td>
		            </tr>
		            <tr>
		              <td align="right" bgcolor="#ffffff">{$lang.favourable_amount}</td>
		              <td bgcolor="#ffffff">{$favourable.formated_min_amount} --- {$favourable.formated_max_amount}</td>
		            </tr>
		            <tr>
		              <td align="right" bgcolor="#ffffff">{$lang.favourable_type}</td>
		              <td bgcolor="#ffffff">
		                <span class="STYLE1">{$favourable.act_type_desc}</span>
		                <!-- {if $favourable.act_type eq 0} -->
		                <!-- {foreach from=$favourable.gift item=gift} --><br />
		                  <input type="checkbox" value="{$gift.id}" name="gift[]" />
		                  <a href="goods.php?id={$gift.id}" target="_blank" class="f6">{$gift.name}</a> [{$gift.formated_price}]
		                <!-- {/foreach} -->
		              	<!-- {/if} -->          
		              </td>
		            </tr>
		            <!-- {if $favourable.available} -->
		            <tr>
		              <td align="right" bgcolor="#ffffff">&nbsp;</td>
		              <td align="center" bgcolor="#ffffff"><input type="image" src="images/bnt_cat.gif" alt="Add to cart"  border="0" /></td>
		            </tr>
		            <!-- {/if} -->
		          </table>
		          <input type="hidden" name="act_id" value="{$favourable.act_id}" />
		          <input type="hidden" name="step" value="add_favourable" />
		        </form>
		        <!-- {/foreach} 循环赠品活动结束 -->
		  </div>
		  </div>
		  <!-- {/if} -->
		  <!-- #优惠活动end -->		
		
		


		<!-- {if $step eq "consignee"} -->
        <!-- #开始收货人信息填写界面 -->
    <div id="hd">
		<div class="wp2">
			<a href="/" class="logo l"><img src="images/logo.jpg" alt=""></a>
			<div class="hdr r">
				<ul class="ul-step">
					<li>1.我的购物车 ></li>
					<li class="on">2.确认订单信息 ></li>
					<li>3.提交订单 ></li>
				</ul>
			</div>
		</div>
	</div>
  	<div class="c"></div>
        {insert_scripts files='region.js,utils.js'}
        <script type="text/javascript">
          region.isAdmin = false;
          {foreach from=$lang.flow_js item=item key=key}
          var {$key} = "{$item}";
          {/foreach}

          {literal}
          onload = function() {
            if (!document.all)
            {
              document.forms['theForm'].reset();
            }
          }
          {/literal}
        </script>
        <!-- 如果有收货地址，循环显示用户的收获地址 -->
        <!-- {foreach from=$consignee_list item=consignee key=sn} -->
        <form action="flow.php" method="post" name="theForm" id="theForm" onsubmit="return checkConsignee(this)">
        <!-- #BeginLibraryItem "/Library/consignee.lbi" --><!-- #EndLibraryItem -->
        </form>
        <!-- {/foreach} -->
        <!-- {/if} -->
		<!-- #结束收货人信息填写界面 -->




        <!-- {if $step eq "checkout"}  -->
        <!-- #订单确认界面开始 -->
      
		<div id="hd">
			<div class="wp2">
				<a href="/" class="logo l"><img src="images/logo.jpg" alt=""></a>
				<div class="hdr r">
					<ul class="ul-step">
						<li>1.我的购物车 ></li>
						<li class="on">2.确认订单信息 ></li>
						<li>3.提交订单 ></li>
					</ul>
				</div>
			</div>
	   </div>
	  
    <div class="c"></div>
	<div id="bd">
		<div class="wp2">
			<div class="c-tit1">
				<a class="r" href="/flow.php?step=cart">< 返回继续购物</a>
				<strong>填写并确认订单信息</strong>
			</div>	
			<div class="h15"></div>

	  {insert_scripts files='showdiv.js'}
	  <script type="text/javascript">
	  {foreach from=$lang.password_js item=item key=key}
	    var {$key} = "{$item}";
	  {/foreach}
	
	  </script>
	 
        {insert_scripts files='region.js,utils.js'}
	
        <script type="text/javascript">
	          region.isAdmin = false;
	          {foreach from=$lang.flow_js item=item key=key}
	          var {$key} = "{$item}";
	          {/foreach}
	
	          {literal}
	          onload = function() {
	            if (!document.all)
	            {
	              document.forms['theForm'].reset();
	            }
	          }
	          {/literal}
	        </script>
	
	        <script type="text/javascript">
	        var flow_no_payment = "{$lang.flow_no_payment}";
	        var flow_no_shipping = "{$lang.flow_no_shipping}";
	        
	       
	
		function formSubmit(fcart)
		{
			fcart.submit();
		}
	    </script>
	    
      
	  
	  
	  
      <div class="blank"></div>
      <div class="blank"></div>

      <div>      
			<!--修改代码 by pgge  start -->
           <!--收货人地址开始-->
           <h3 class="c-tit3">收货人信息 <a class="xg1" href="javascript:void(0)" style="<!-- {if $smarty.session.flow_consignee} -->display:inline-block;<!-- {else} -->display:none;<!-- {/if} -->">修改</a></h3>	
            <!-- 如果有收货地址，循环显示用户的收货地址 -->
             <div class="shou-info <!-- {if $smarty.session.flow_consignee} --><!-- {else} -->c-cur-bor<!-- {/if} -->">
	             <p class="info dn" style="<!-- {if $smarty.session.flow_consignee} -->display:block;<!-- {else} -->display:none;<!-- {/if} -->">收货人信息：
             		<span id="consignee" style="padding-left: 5px;">{$smarty.session.flow_consignee.consignee}</span>
             		<span id="mobile" style="padding-left: 10px;">{$smarty.session.flow_consignee.mobile}</span>  
             		<span id="address" style="padding-left: 5px;">{$smarty.session.flow_consignee.province_name}{$smarty.session.flow_consignee.city_name}{$smarty.session.flow_consignee.district_name}{$smarty.session.flow_consignee.address}</span>
	             </p>
		       	 <div id="order_address_list" class="">
		       	 <!-- #BeginLibraryItem "/Library/order_address_list.lbi" --><!-- #EndLibraryItem -->
		       	 </div>
		       	 
			</div>
	      <!--收货人地址结束-->
	      
	      
		<!--修改代码 by pgge  end -->
      </div>
     	
     	<form action="flow.php" method="post" name="theForm" onsubmit="return checkOrder();"> 
		<div class="h15"></div>
			<h3 class="c-tit3">配送及支付方式 <a class="xg2" href="javascript:void(0);">修改</a></h3>
            <div id="ECS_SHIPPING_PARMENT" >
            <!-- #BeginLibraryItem "/Library/order_shipping_payment.lbi" --><!-- #EndLibraryItem -->
	 		</div>
	            
	  <!-- 商品信息start -->          
	  <div class="h15"></div>
	  <h3 class="c-tit3">商品信息</h3>
        <table class="c-table1 c-table2">
            <tr>
              <th class="tl" width="110"></th>	
              <th width="180">商品信息</th>
              <th width="150"></th>
              <th style="display: none;">{$lang.goods_attr}</th>
              <th width="150">商品价格（元）</th>
              <th width="90">数量</th>
              <!-- <th width="150">促销</th> -->
		      {*代码增加 By www.ecshop120.com 多城市多仓库*}
		      <th>库存</th>
		      {* 代码增加_end By www.ecshop120.com *}                 
            </tr>

            <!-- {foreach from=$goods_list item=goods} -->
            <tr class="bg">
	            <td class="tr">
		            {if $goods.is_momsuit eq 1}
		            	<a {if $goods.goods_id gt 0 && $goods.extension_code eq 'package_buy'}style="display:none;"{/if} href="momsuit.php?suit_id={$goods.goods_id}" target="_blank">
		            	<img src="{$goods.goods_thumb}" border="0" title="{$goods.goods_name|escape:html}" /></a>
		            {elseif $goods.is_momsuit eq 0}
			        	<a {if $goods.goods_id gt 0 && $goods.extension_code eq 'package_buy'}style="display:none;"{/if} href="{$goods.goods_url}" target="_blank" >
			        	<img src="{$goods.goods_thumb}"  border=0 ></a>
		            {/if}
	            </td>
              <td>
			      <!-- {if $goods.goods_id gt 0 && $goods.extension_code eq 'package_buy'} -->
			     		 <a href="javascript:void(0)" onclick="setSuitShow({$goods.goods_id})" class="f6">{$goods.goods_name}<span style="color:#FF0000;">（{$lang.remark_package}）</span></a>
			      		<div id="suit_{$goods.goods_id}" style="display:none">
				          	<!-- {foreach from=$goods.package_goods_list item=package_goods_list} -->
					    		<div style="display: block;min-height: 60px;float: left; margin-top: 5px;">
			                        <a href="{$package_goods_list.goods_url}" target="_blank">
			                        	<img src="{$package_goods_list.goods_thumb}" border="0" title="" />
			                        </a>
			                        
			                        <a href="{$package_goods_list.goods_url}" target="_blank" class="f6" style="">{$package_goods_list.goods_name}</a><br />
		                        </div>
		                        
				          	<!-- {/foreach} -->
			     		 </div>
			      <!-- { else } -->
			      		{if $goods.is_momsuit eq 1}
			      		<a href="momsuit.php?suit_id={$goods.goods_id}" target="_blank" class="f6">{$goods.goods_name}</a>
			      		{elseif $goods.is_momsuit eq 0}
			      		<a href="{$goods.goods_url}" target="_blank" class="f6">{$goods.goods_name}</a>
			      		{/if}
		                <!-- {if $goods.parent_id > 0} -->
		                <span style="color:#FF0000">（{$lang.accessories}）</span>
		               <!-- {elseif $goods.is_gift} -->
		                <span style="color:#FF0000">（{$lang.largess}）</span>
		                <!-- {/if} -->
		          <!-- {/if} -->
		          
        		<!-- {if $goods.is_shipping} -->(<span style="color:#FF0000">{$lang.free_goods}</span>)<!-- {/if} -->
              	
              	<!--add by wanggz商品买满多少件送一件的优惠活动-->
                <!-- {if $goods.gift_goods_number gt 0}  -->
                <br />
                              <span style="color:#FF0000">您购买了本商品{$goods.goods_number}件，免费赠送{$goods.gift_goods_number}件！</span>             
                <!-- {/if} -->
                
               	<!--add by wanggz商品买满多少件送一件的优惠活动end-->
	          </td>
              <td style="">{$goods.goods_attr|nl2br}</td>
              <td><b>{$goods.formated_goods_price}</b></td>
              <td>{$goods.goods_number}</td>
              <td style="display: none;">	      
			      <!--修改代码_start  By www.ecshop120.com-->                
				<a href="javascript:minus_num(document.getElementById('formCart'), {$goods.rec_id});">
				<img src="images/bag_close.gif" border=0></a>
				<input type="text" onKeyDown='if(event.keyCode == 13) event.returnValue = false' name="goods_number[{$goods.rec_id}]" id="goods_number_{$goods.rec_id}" value="{$goods.goods_number}" size="4" class="inputBg" style="text-align:center;" onblur="formSubmit(this.form)"/>
				<input type="hidden" id="hidden_{$goods.rec_id}" value="{$goods.goods_number}"><a href="javascript:add_num(document.getElementById('formCart'),{$goods.rec_id})" >
				<img src="images/bag_open.gif" border=0></a>
				<!--修改代码_end  By www.ecshop120.com-->	      
		      </td>
		      <!-- <td>
					<div class="cuxiao">
					<p>买5送1</p>
					<p><a href="" title="雅培金装喜康力幼儿配方奶粉粉段900g雅培金装喜康力幼儿奶粉"><img src="images/p2.jpg" alt=""></a><a href="" title="雅培金装喜康力幼儿配方奶粉粉段900g雅培金装喜康力幼儿奶粉"><img src="images/p2.jpg" alt=""></a><a href="" title="雅培金装喜康力幼儿配方奶粉粉段900g雅培金装喜康力幼儿奶粉"><img src="images/p2.jpg" alt=""></a></p>
					</div>
				</td> -->
		      {* 代码增加_start By www.ecshop120.com 多城市多仓库*}
		      <td>有货</td>
		      {* 代码增加_end By www.ecshop120.com *}   
		      	      
              <td align="left" style="display: none;" id="subtotal_{$goods.rec_id}" >{$goods.formated_subtotal}</td>
            </tr>
            <!-- {/foreach} -->
            <!-- {if !$gb_deposit} 团购且有保证金时不显示 -->

            
            <!-- {/if} -->
          </table>

	  <!-- 商品信息end -->    
	  
	  <!-- 订单备注 start-->
	  <div class="h15"></div>
	  <h3 class="c-tit3">订单备注</h3>
	  <div class="postscript">
      		<input name="postscript" type="text" value="" size="90" placeholder="限45个字（定制类商品，请将购买需求在备注中做详细说明）"	/>	
	  </div>     
	  <!-- 订单备注end -->
	  
	  
	  <!-- 发票信息start -->
	  <div class="h15"></div>
	  <h3 class="c-tit3">发票信息</h3>
	  <div class="inv">
       <p>
       	<strong style="display:none;">{$lang.invoice}:</strong>
           <input name="need_inv" type="checkbox"  class="inputBg" id="ECS_NEEDINV" onclick="changeNeedInv()" value="1" {if $order.need_inv}checked="true"{/if} />
         
           <!-- {if $inv_type_list} -->
           &nbsp;{$lang.invoice}:&nbsp;{$lang.invoice_type}
           <select name="inv_type" id="ECS_INVTYPE" {if $order.need_inv neq 1}disabled="true"{/if} onchange="changeNeedInv()" style="border:1px solid #ccc;">
           {html_options options=$inv_type_list selected=$order.inv_type}</select>
           <!-- {/if} -->
           {$lang.invoice_title}
           <input name="inv_payee" type="text" placeholder="填写个人名称/公司名称" class="inputBg" id="ECS_INVPAYEE" size="50" {if !$order.need_inv}disabled="true"{/if} value="{$order.inv_payee}" onblur="changeNeedInv()" />
           
         	<!-- 
         	{$lang.invoice_content}
         	 -->
         	<select name="inv_content" id="ECS_INVCONTENT" {if $order.need_inv neq 1}disabled="true"{/if}  onchange="changeNeedInv()" style="border:1px solid #ccc;display: none;">
           {html_options values=$inv_content_list output=$inv_content_list selected=$order.inv_content}
           </select>
        </p>
	  </div>     
	  <!-- 发票信息end -->      
	  
	  
	    <!-- 结算信息start -->   
        <div class="h15"></div>
		<h3 class="c-tit3">结算信息</h3>
		<div class="h"></div>
		<div class="jsxx">
		   <p>本次订单可使用积分：<em>{$order_max_integral}{$points_name}</em>，使用红包：<em>￥{$order_max_bonus|default:0}</em></p>
			<!-- {if $allow_use_integral} 是否使用积分 -->
			<div class="jf">
				<span class="show-btn <!-- {if $order_max_integral > 0} -->ok<!-- {/if} -->">使用积分</span>
				<p style="<!-- {if $order_max_integral > 0} -->display: block;<!-- {/if} -->">
					您有积分<span>{$your_integral|default:0} {$points_name}</span>，本次可用<span>{$order_max_integral}{$points_name}</span>　
					使用	<input name="integral" type="text" class="inputBg" id="ECS_INTEGRAL" onblur="changeIntegral(this.value)" value="{$order.integral|default:0}" size="10" />积分　
					<span id="ECS_INTEGRAL_NOTICE" class="notice"></span>
				</p>
			</div>
			 <!-- {/if} 是否使用积分 -->
			 
			 <!-- {if $allow_use_bonus} 是否使用红包 -->
			<div class="hb">
				<span class="show-btn <!-- {if $order_max_bonus > 0} -->ok<!-- {/if} -->">使用红包</span>
				
				<p style="<!-- {if $order_max_bonus > 0} -->display: block;<!-- {/if} -->">
				<!-- 您有红包<span>￥10.00</span>，本次可用<span>￥{$order_max_bonus|default:0}</span>　 -->
				<!-- {foreach from=$bonus_list item=bonus} -->
                 <input type="checkbox" <!-- {if $bonus.is_checked eq '1'} -->checked="checked"<!-- {/if} --> onclick="return selectBonus(this);" name="bonus_list[]" id="bonus_{$bonus.bonus_id}" value="{$bonus.bonus_id}"/>{$bonus.type_name}[{$bonus.bonus_money_formated}]&nbsp;&nbsp;<br/>
               	<!-- {/foreach} -->
                 
                 <br/>
                 
				{foreach from=$spec_bonus_list item=spec_bonus}
				<input type="checkbox" onclick="return selectSpecBonus(this.value);" name="bonus_ids[]" id="bonus_{$spec_bonus.bonus_id}" value="{$spec_bonus.bonus_id}"/>{$spec_bonus.type_name}[{$spec_bonus.bonus_money_formated}]&nbsp;&nbsp;
				{/foreach}
			
                <input style="display:none;" name="bonus_sn" type="text" class="inputBg" size="15" value="{$order.bonus_sn}"/> 
                <input style="display:none;" name="validate_bonus" type="button" style="background:url(images/bg_yellow.gif) no-repeat 0 0; width:82px; height:25px;  text-align:center; line-height:25px; color:#333; border:none; cursor:pointer;overflow:hidden" value="使用红包" onclick="validateBonus(document.forms['theForm'].elements['bonus_sn'].value)" /> 
                
				<!-- {/if} 是否使用红包 -->
				</p>
			</div>
		<p> 
		
   	   </p>
   	   
 	   	<!-- {if $allow_use_surplus} 是否使用余额start -->
         <strong>{$lang.use_surplus}: </strong>
          <input name="surplus" type="text" class="inputBg" id="ECS_SURPLUS" size="10" value="{$order.surplus|default:0}" onblur="changeSurplus(this.value)" {if $disable_surplus}disabled="disabled"{/if} />
           {$lang.your_surplus}{$your_surplus|default:0} <span id="ECS_SURPLUS_NOTICE" class="notice"></span></p>
        <!-- {/if} 是否使用余额end -->
   		
   		<!-- 订单付款汇总start -->
		<div id="ECS_ORDERTOTAL" >
		<!-- #BeginLibraryItem "/Library/order_total.lbi" --><!-- #EndLibraryItem -->
		</div>	
		<!-- 订单付款汇总end -->
           
       </div>
       <!-- 结算信息end -->
	         
        <!-- 订单提交start -->
        <div class="h"></div>
        <div class="c-jie1 c-jie2" style="width:990px;margin: 0 auto;padding-left: inherit;">	
			<span class="r">
			<input type="hidden" value="{$smarty.session.flow_consignee.address_id}" id="address_id"/>
	 		<input type="hidden" name="step" value="done"/>
	 		<input type="submit" class="btn" id="btn_submit_order"  value="提交订单"/>
			</span>
 		</div> 
 		<!-- 订单提交end -->
   			
   		</form>  
   			
	     </div>
	</div>
	
	 	<div class="h"></div>
	 	
	 	<script type="text/javascript">
		$(function(){
			
			/***点击修改收货地址链接***/
			$(".xg1").click(function(){
				$(".shou-info").addClass("c-cur-bor");
				$(".shou-info .address_list").show();
				$(".shou-info .info").hide();
				
				$(".ps-zf").removeClass("c-cur-bor");
				$(".ps-zf .form").hide();
				$(".ps-zf .info").show();
				
				refresh_address_list('edit');
			});
			
			/***点击修改配送已经支付方式链接***/
			$(".xg2").click(function(){
				$(".ps-zf").addClass("c-cur-bor");
				$(".ps-zf .form").show();
				$(".ps-zf .info").hide();
			});
			
		   	$(".jsxx .show-btn").click(function(){
		   		if ($(this).hasClass('ok')){
		   			$(this).removeClass('ok');
		   			$(this).next('p').slideUp();
		   		} else{
		   			$(this).addClass('ok');
		   			$(this).next('p').slideDown();
		   		}
		   	});
		   	
		   	
		   	/* $(".consignee_radio").click(function(){
		   		var address_id = $(this).val();
		   		$(".address_row").hide();
		   		$("#addr_box_"+address_id).show();
		   		
		   		
		   	}); */
		   	
		});
		
		
		function click_address_row(address_id){
			$(".address_row").hide();
	   		$("#addr_box_"+address_id).show();
		} 
		
		
		function edit_address(address_id){
			if($('#addr_box_'+address_id).css('display')=='none'){
				$(".address_row").hide();
				$('#addr_box_'+address_id).show();
				$('#radio_'+address_id).prop('checked',true);
	   		}
		}
		
		
		/***选择收货人，收货地址***/
        function select_address(address_id){
			//验证数据是否有效
			//var $form = $("#address_form_"+address_id);
			var form = document.getElementById("address_form_"+address_id);
			if(!checkConsignee(form)){
				return false;
			}
			
			
        	$.ajax({     
        	    url:'flow.php?step=select_consignee',     
        	    type:'post',  
        	    dataType:'json', 
        	    data:$("#address_form_"+address_id).serialize(),     
        	    async :true, 
        	    error:function(){ 
        	    	//alert('更新出错！');
        	    },     
        	    success:function(data){ 
        		    if(data.status==1){
        		    	console.debug(data);
        		    	
        		    	//显示，隐藏显示区域
        		    	$(".shou-info").removeClass("c-cur-bor");
        				$(".shou-info .address_list").hide();
        				$(".shou-info .info").show();
        				$(".ps-zf").addClass("c-cur-bor");
        				$(".ps-zf .tishi").hide();
        				$(".xg1").show();
        				$(".ps-zf .form").show();
        				
        				//设置选中的地址
        				$("#address_id").val(data.content.address_id);
        				
        				//设置显示值
        				$("#consignee").text(data.content.consignee);
        				$("#mobile").text(data.content.mobile);
        				$("#address").text(data.content.province_name+data.content.city_name+data.content.district_name+data.content.address);
        				
        				
        				//TODO:重新刷新页面，计算的逻辑太多了
        				//window.location.href = 'flow.php?step=checkout';
        				order_shipping_payment_total();
        		    }else{
        		    	alert(data.message);
        		    }
        	    }  
        	}); 
        }
		
        /***改变收货人信息时修改配送、支付、订单汇总***/
        function order_shipping_payment_total(address_id){
        	$.ajax({     
        	    url:'flow.php?step=order_shipping_payment_total',     
        	    type:'post',  
        	    dataType:'json', 
        	    data:{},     
        	    async :true, 
        	    error:function(){ 
        	    	//alert('更新出错！');
        	    },     
        	    success:function(data){ 
        	    	//console.debug(data);
        		    if(data.error==''){
        		    	$("#ECS_SHIPPING_PARMENT").html(data.content);
        		    	$("#ECS_ORDERTOTAL").html(data.total);
        		    }else{
        		    	alert(data.error);     		    	
        		    }
        	    }  
        	}); 
        }
		
		
		
        /***删除货人信息***/
        function drop_consignee(address_id){
        	if(!confirm('你确认要删除该收货地址吗？')){
        		return false;
        	}
        	$.ajax({     
        	    url:'user.php?act=drop_consignee',     
        	    type:'post',  
        	    dataType:'json', 
        	    data:{"id":address_id,'is_ajax':'1'},     
        	    async :true, 
        	    error:function(){ 
        	    	//alert('更新出错！');
        	    },     
        	    success:function(data){ 
        		    if(data.status==1){
        		    	//$("#row_address_"+address_id).remove();
        		    	refresh_address_list();
        		    }else{
        		    	if(data!=null){
        		    		alert(data.message);
        		    	}else{
        		    		alert(data);
        		    	}
        		    	
        		    }
        	    }  
        	}); 
        }
        
        
        /***设置默认货人信息***/
        function default_consignee(address_id){
        	$.ajax({     
        	    url:'user.php?act=default_consignee',     
        	    type:'post',  
        	    dataType:'json', 
        	    data:{"id":address_id,'is_ajax':'1'},     
        	    async :true, 
        	    error:function(){ 
        	    	//alert('更新出错！');
        	    },     
        	    success:function(data){ 
        		    if(data.status==1){
        		    	//$("#row_address_"+address_id).remove();
        		    	refresh_address_list();
        		    }else{
        		    	if(data!=null){
        		    		alert(data.message);
        		    	}else{
        		    		alert(data);
        		    	}
        		    	
        		    }
        	    }  
        	}); 
        }
        
        /**重新加载地址列表****/
        function refresh_address_list(act){
        	$.ajax({     
        	    url:'flow.php?step=address_list',     
        	    type:'post',  
        	    dataType:'html', 
        	    data:{act:'edit'},     
        	    async :true, 
        	    error:function(){ 
        	    	//alert('更新出错！');
        	    },     
        	    success:function(data){ 
        		    $("#order_address_list").html(data);
        	    }  
        	}); 
        }
        
        
        /**改变配送方式和支付方式****/
        function select_shipping_payment(){
        	var shipping_id = $("input[name='shipping']:checked").val();
        	var pay_id = $("input[name='payment']:checked").val();
        	//console.debug(shipping_id);
        	//console.debug(pay_id);
        	
        	$.ajax({     
        		url:'flow.php?step=select_shipping_payment',     
        	    type:'post',  
        	    dataType:'json', 
        	    data:{"shipping_id":shipping_id,'pay_id':pay_id},     
        	    async :true, 
        	    error:function(){ 
        	    	//alert('更新出错！');
        	    },     
        	    success:function(data){ 
        		    if(data.status==1){
        		    	//$("#row_address_"+address_id).remove();
        		    	
        		    	$(".ps-zf .form").hide();
        		    	$(".ps-zf .info").show();
        				$(".xg2").show();
        				$(".ps-zf").removeClass("c-cur-bor");
        		    	
        				$("#txt_shipping_name").text($("#shipping_name_"+shipping_id).val());
        				$("#txt_payment_name").text($("#payment_name_"+pay_id).val());
        		    	
        		    }else{
        		    	if(data!=null){
        		    		alert(data.message);
        		    	}else{
        		    		alert(data);
        		    	}
        		    	
        		    }
        	    }  
        	}); 
        }
        
		function add_num(f, rec_id)
		 {
			document.getElementById("goods_number_"+rec_id+"").value++;
			//var number = document.getElementById("goods_number_"+rec_id+"").value;
			//Ajax.call('flow.php', 'step=update_group_cart&rec_id=' + rec_id +'&number=' + number+'&goods_id=' + goods_id, changePriceResponse, 'GET', 'JSON');
			f.submit();
		 }
	
		function minus_num(f, rec_id)
		{
			if (document.getElementById("goods_number_"+rec_id+"").value>1)
			{
				document.getElementById("goods_number_"+rec_id+"").value--;
			}
			//var number = document.getElementById("goods_number_"+rec_id+"").value;
			//Ajax.call('flow.php', 'step=update_group_cart&rec_id=' + rec_id +'&number=' + number+'&goods_id=' + goods_id, changePriceResponse, 'GET', 'JSON');
			f.submit();
		}

		function change_price(rec_id,goods_id)
		{
			var r = /^[1-9]+[0-9]*]*$/;
			var number = document.getElementById("goods_number_"+rec_id+"").value;
			if (!r.test(number))
			{
				alert("您输入的格式不正确！");
				document.getElementById("goods_number_"+rec_id+"").value=document.getElementById("hidden_"+rec_id+"").value;
			}
			else
			{
				Ajax.call('flow.php','step=update_group_cart&rec_id=' + rec_id +'&number=' + number+'&goods_id=' + goods_id, changePriceResponse, 'GET', 'JSON');
			}
		}
		
		function changePriceResponse(result)
		{
			if(result.error == 1)
			{
				alert(result.content);
				document.getElementById("goods_number_"+result.rec_id+"").value =result.number;
				document.getElementById("hidden_"+result.rec_id+"").value =result.number;
			}
			else
			{
				document.getElementById("hidden_"+result.rec_id+"").value =result.number;
				document.getElementById('subtotal_'+result.rec_id).innerHTML = result.subtotal;//商品总价
				document.getElementById('cart_amount_desc').innerHTML = result.cart_amount_desc;//购物车商品总价说明
				document.getElementById('market_amount_desc').innerHTML = result.market_amount_desc;//购物车商品总市价说明
				show_div_text = "恭喜您！ 商品数量修改成功！ ";
				showdiv(document.getElementById("goods_number_"+result.rec_id));
			}
		
		}
		
		function selectBonus(obj){
			var order_max_bonus=<!--{if $order_max_bonus} -->{$order_max_bonus}<!--{else}-->0<!--{/if}-->;
			//可用红包金额为零，不允许使用红包
			if(order_max_bonus==0){
				alert('抱歉，以上商品不能使用红包！');
				return false;
			}
			
			//获取选中的所有的红包
			var bonuses = new Array();
			$.each($("input[name='bonus_list[]']:checked"),function(i,v){
				bonuses.push($(v).val());
    		});
			
			/* var bonus_ids="";
			$.each(bonuses,function(i,v){
				bonus_ids +=("bonus["+i+"]="+v+"&");
    		}); */
			//onfirm("本红包金额高于可用金额，每个只能使用一次，不找零哦！")){
			$.ajax({
				url:'/flow.php?step=select_bonus',
				type:'POST',
				data:{'bonus':bonuses},
				dataType:'json',
				success:function(data){
					if(data.error==""){
						document.getElementById("ECS_ORDERTOTAL").innerHTML=data.content;
					}else if(data.error=="notify"){
						document.getElementById("ECS_ORDERTOTAL").innerHTML=data.content;
						alert(data.message);
					}else{
						alert(data.error);
					}
				}
			});
		}
		
		function sure(bonus_id){
			$.ajax({
				url:'/flow.php?step=validate_bonus_ids',
				type:'get',
				data:{'bonus_id':bonus_id,'bonus_surplus':$('#bonus_surplus').html(),'confirm':'yes'},
				dataType:'json',
				success:function(rs){
					if(rs.success=='yes'){
						$('#bonus_surplus').html(rs.bonus_surplus);
						document.getElementById("ECS_ORDERTOTAL").innerHTML=rs.content;
					}
				}
			});
		}
		
		/*
		* 此方法暂时用不上，无业务与此代码关联
		*/
		function selectSpecBonus(bonus_id){
			//取消选中，添加参数为cancel
			var cancel='';
			if(!$('#bonus_'+bonus_id).attr('checked')){
				cancel='yes';
			}
			specAjax(bonus_id,cancel);
		}
		
		function specAjax(bonus_id,cancel){
			$.ajax({
				url:'/flow.php?step=validate_bonus_ids',
				type:'get',
				data:{'bonus_id':bonus_id,'tag':'spec_bonus','cancel':cancel},
				dataType:'json',
				success:function(rs){
					if(rs.error){
						alert(rs.error);
					}
					if(rs.success=='yes'){
						//$('#ECS_ORDERTOTAL').html(rs.content);
						document.getElementById("ECS_ORDERTOTAL").innerHTML=rs.content;
					}
				}
				
			});
		}
		
		/***订单提交验证***/
		function checkOrder(){
			
			var address_id = $("#address_id").val();
			if(address_id==null || address_id==''){
				alert('请选择收货人信息。');
				return false;
			}
			
			var shipping_id = $("input[name='shipping']:checked").val();
			if(shipping_id==null){
				alert('请选择配送方式。');
				return false;
			}
			
        	var pay_id = $("input[name='payment']:checked").val();
        	if(pay_id==null){
				alert('请选择支付方式。');
				return false;
			}
        	
        	$("#btn_submit_order").attr("disabled",true).css("background-color",'#efefef'); 
        	
        	
			return true;
		}
		
		/*选择自提点**/
		
		function select_pick_up_point(obj){
			$(".pick_up_point_ckb").attr('checked',false);
			$(obj).attr('checked',true);
		}
		</script>
	 	
        <!-- {/if} -->
        <!-- #订单确认界面结束 -->
        
        
        

        <!-- {if $step eq "done"} -->
        <!-- #订单提交成功开始 -->
		<div id="hd">
			<div class="wp2">
				<a href="/" class="logo l"><img src="images/logo.jpg" alt=""></a>
				<div class="hdr r">
					<ul class="ul-step">
						<li>1.我的购物车 ></li>
						<li>2.确认订单信息 ></li>
						<li class="on">3.提交订单 ></li>
					</ul>
				</div>
			</div>
		</div>
		
	  <div class="c"></div>
	   <div class="flowBox mod2">
         <span class="lt"></span><span class="lb"></span><span class="rt"></span><span class="rb"></span>
         
         <h6 style="text-align:center; margin-top:20px; border-bottom:#C91422 2px solid; padding-bottom:10px;">{$lang.remember_order_number}: <font style="color:red">{$order.order_sn}</font></h6>
         
         <!-- {if $nfsum > 4} -->
         <!--<form action="flow.php?step=deposit" id="depositForm" name="depositForm" method="post">
         <h6 style="text-align:center; margin-top:20px; border-bottom:#C91422 2px solid; padding-bottom:10px;">
			系统提示：你所购奶粉数量达到享受寄存的服务，是否寄存？&nbsp;&nbsp;<input id="Submit1" style="padding:2px 5px;" type="submit" value="是" />&nbsp;&nbsp;<input id="but11" style="padding:2px 5px;" type="button" value="否" onclick="javascript:history.back();" />
		 </h6>
		 </form>-->
         <!-- {/if} -->
         
          <table width="100%" align="center" border="0" cellpadding="10" cellspacing="0" bgcolor="#fff" style="border-bottom:1px solid #ddd; margin:20px auto;" >
            <tr>
              <td align="center" bgcolor="#FFFFFF">
              <!--{if $order.shipping_name}-->{$lang.select_shipping}: <strong>{$order.shipping_name}</strong>，<!--{/if}-->{$lang.select_payment}: <strong>{$order.pay_name}</strong>。{$lang.order_amount}: <strong style="color: red;font-size: 19px;font-weight: bold;">{$total.amount_formated}</strong>
              </td>
            </tr>
            
            <!-- {if $pay_online} -->
            <!-- 如果是线上支付则显示支付按钮 -->
            <tr class="online_pay">
              <td align="center" bgcolor="#FFFFFF">{$pay_online}</td>
            </tr>
            <!-- {/if} -->  
                      
            <tr>
              <td align="center" bgcolor="#FFFFFF">{$order.pay_desc}</td>
            </tr>
			<style type="text/css">
				.online_pay input[type="submit"],.online_pay input[type="button"]{
				background-color: red;
				color: white;
				height: 40px;
				line-height: 40px;
				width: 180px;
				font-size: 16px;
				font-weight: bolder;
				border: 2px solid;
				border-radius: 6px;
				cursor: pointer;
				 }
			</style>
          </table>
          
          <!--{if $virtual_card}-->
          <div style="text-align:center;overflow:hidden;border:1px solid #E2C822;background:#FFF9D7;margin:10px;padding:10px 50px 30px;">
          <!--{foreach from=$virtual_card item=vgoods}-->
            <h3 style="color:#2359B1; font-size:12px;">{$vgoods.goods_name}</h3>
            <!--{foreach from=$vgoods.info item=card}-->
              <ul style="list-style:none;padding:0;margin:0;clear:both">
              <!--{if $card.card_sn}-->
              <li style="margin-right:50px;float:left;">
              <strong>{$lang.card_sn}:</strong><span style="color:red;">{$card.card_sn}</span>
              </li><!--{/if}-->
              <!--{if $card.card_password}-->
              <li style="margin-right:50px;float:left;">
              <strong>{$lang.card_password}:</strong><span style="color:red;">{$card.card_password}</span>
              </li><!--{/if}-->
              <!--{if $card.end_date}-->
              <li style="float:left;">
              <strong>{$lang.end_date}:</strong>{$card.end_date}
              </li><!--{/if}-->
              </ul>
            <!--{/foreach}-->
          <!--{/foreach}-->
          </div>
          <!--{/if}-->
          
          <p style="text-align:center; margin-bottom:20px;" class="submit_back">{$order_submit_back}</p>
          </div>
          <style>
          .submit_back a{ color:#F00;}
          </style>
         </div>
         
         <!-- {/if} -->
         <!-- #订单提交成功结束 -->
         
         
        <!-- {if $step eq "deposit"} -->
        <!-- 奶粉寄存条款 -->
        <div class="block">
		<<div id="hd">
		<div class="wp2">
			<a href="" class="logo l"><img src="images/logo.jpg" alt=""></a>
			<div class="hdr r">
				<ul class="ul-step">
					<li>1.我的购物车 ></li>
					<li class="on">2.确认订单信息 ></li>
					<li>3.提交订单 ></li>
				</ul>
			</div>
		</div>
	</div>
  <div class="c"></div>
		<div class="flowBox mod2">
			<form action="flow.php" id="deposit2Form" name="deposit2Form" method="post">
			<h6 style="text-align:left; margin-top:20px; border-bottom:#C91422 2px solid; padding-bottom:10px; height: auto;">
			寄存条例<br/>
		    1、	不能到门店提货，<br/>
			2、	在商城自有配送服务范围内每次要求发货数量不低于3罐/盒/包才能享受免费送货服务；低于3罐/盒/包者，则统一发快递，由客户到付快递费。<br/>
			3、	在商城自有配送服务范围以外者，不管每次要求奶粉发货数量多少，快递费均由客户到付。<br/>
			4、	寄存服务有效期一年，超过一年不提货者视放弃，到期前会提前一个月提醒会员。<br/>
			</h6>
			<h6 style="text-align:center; margin-top:20px; padding-bottom:10px;">
				<input style="padding:2px 5px;" type="submit" value="同意/下一步" />&nbsp;&nbsp;&nbsp;
				<input style="padding:2px 5px;" type="button" value="取 消" onclick="javascript:history.back();" />
				<input type="hidden" name="step" value="depositNum" />
				
			</h6>
			</form>
			<!--<form action="flow.php" id="deposit4Form" name="deposit4Form" method="post">
			<input style="padding:2px 5px;" type="submit" value="测 试" />
			<input type="hidden" name="step" value="test" />
			</form>-->
		</div>
        </div>
        <!-- {/if} -->



		<!-- {if $step eq "depositNum"} -->
        <!-- 奶粉寄存件数 -->
        <div class="block">
		<div id="hd">
		<div class="wp2">
			<a href="/" class="logo l"><img src="images/logo.jpg" alt=""></a>
			<div class="hdr r">
				<ul class="ul-step">
					<li>1.我的购物车 ></li>
					<li class="on">2.确认订单信息 ></li>
					<li>3.提交订单 ></li>
				</ul>
			</div>
		</div>
	</div>
  <div class="c"></div>
		
		<form action="flow.php" id="depositConfirmForm" name="depositConfirmForm" method="post">
        <script language="javascript" type="text/javascript">                 
			function goods_cut($val, ids, dqs, zds){                     
				var num_val=document.getElementById(ids+$val);
				var num_valc=document.getElementById("numberc"+$val);   
				var hidz = document.getElementById("hidZ");                    
				var new_num=$.trim(num_val.value);                     
				if(new_num==""){alert('值不能为空');return false}                     
				if(isNaN(new_num)){alert('请输入数字');return false} 
				var zxs = parseInt(hidz.value);   
				var Numc = parseInt(num_valc.value);                 
				var Num = parseInt(new_num);                     
				if(Num>0){
					Num=Num-1;Numc=Numc+1;        
					if(zxs>0){zxs = zxs-1;}
					num_val.value=Num;
					num_valc.value=Numc;
					hidz.value = zxs;   
				} 
				//alert(zxs);                                  
			}                 
						
			function goods_add($val, ids, dqs, zds){                     
				var num_val=document.getElementById(ids+$val); 
				var num_valc=document.getElementById("numberc"+$val); 
				var hidz = document.getElementById("hidZ");                   
				new_num=$.trim(num_val.value);                   
				if(new_num==""){alert('值不能为空');return false}        
				if(isNaN(new_num)){alert('请输入数字');return false}  
				var zxs = parseInt(hidz.value);                   
				var Num = parseInt(new_num);                     
				Num=Num+1; 
				if (Num>parseInt(dqs)){alert('发货数量不能大于购买数量');return false}
				zxs = zxs+1;
				if ((parseInt(zds)-zxs) < 3){alert('寄存数量不能低于3件');return false} 
				//alert(zxs);                 
				var Numc = parseInt(num_valc.value);                   
				num_val.value=Num;    
				num_valc.value=Numc-1;    
				hidz.value = zxs;                                
			}
			
			function clear1(){
				var clearForm = document.getElementById("depositConfirmClearForm");
				clearForm.submit();
			}             
		</script>
		<input id="hidZ" type="hidden" value="0" />
		  <table width="100%" align="center" border="0" cellpadding="5" cellspacing="1" bgcolor="#ffffff" style="border:#DDDDDD 1px solid;">
            <tr>
              <th bgcolor="#F3F3F3">商品名称</th>
              <th bgcolor="#F3F3F3">本次发货数量</th>
              <th bgcolor="#F3F3F3">寄存数量</th>
            </tr>
           
            <!-- {foreach from=$deposit_goods item=dgoods name=dgname} -->          
            <tr>
              <td bgcolor="#FFFDEE" align="center" style="width:60%">
                    <a href="goods.php?id={$dgoods.goods_id}" target="_blank"><img style="width:80px; height:80px;" src="{$dgoods.goods_thumb}" border="0" title="{$dgoods.goods_name}" /></a><br />
                    <a href="goods.php?id={$dgoods.goods_id}" target="_blank" class="f6">{$dgoods.goods_name}</a>
              </td>
              <td align="center" bgcolor="#FFFDEE" style="width:20%">
					<input type="hidden" name="numbethidd[{$dgoods.goods_id}]" value="{$dgoods.goods_id}" />
					<span class="goods_cut" onclick="goods_cut('{$dgoods.goods_id}','number',{$dgoods.goods_number},{$nfsum});" style="margin-left:61px;"></span>
					<input type="text" name="number[{$dgoods.goods_id}]" id="number{$dgoods.goods_id}" value="0" size="4" class="number" readonly="readonly" onblur="if(isNaN(this.value)){alert('请输入数字');return false}" title=""/>
					<span class="goods_add" onclick="goods_add('{$dgoods.goods_id}','number',{$dgoods.goods_number},{$nfsum});"></span>
              </td>
              <td align="center" bgcolor="#FFFDEE" style="width:20%">
					<!--<span class="goods_cut" onclick="goods_cut('{$dgoods.goods_id}','numberc',{$dgoods.goods_number},{$nfsum});" style="margin-left:42px;"></span>-->
					<input type="text" style="margin-left:75px;" name="numberc[{$dgoods.goods_id}]" id="numberc{$dgoods.goods_id}" value="{$dgoods.goods_number}" size="4" readonly="readonly" class="number" onblur="if(isNaN(this.value)){alert('请输入数字');return false}" title=""/>
					<!--<span class="goods_add" onclick="goods_add('{$dgoods.goods_id}','numberc',{$dgoods.goods_number},{$nfsum});"></span>-->
			  </td>
            </tr>
            <!-- {/foreach} -->
            
            <input type="hidden" name="step" value="updaedeposit" />
          </table>
			
          <table width="100%" align="center" border="0" cellpadding="5" cellspacing="1" bgcolor="#F3F3F3" style="border:#dddddd 1px solid; border-top:none;">
            <tr>
              <td bgcolor="#F3F3F3">
			  </td>
              <td align="right" bgcolor="#F3F3F3">
                <input type="submit" value="确认寄存" class="bnt_blue_1" />
                <input name="submit_it" class="bnt_blue_1" value="取 消"  onclick="clear1()" />
                <input type="hidden" name="step" value="depositConfirm" />
                <!--<input type="hidden" name="step" value="test" />-->
              </td>
            </tr>
          </table>
			</form>
			<form action="flow.php" id="depositConfirmClearForm5" name="depositConfirmClearForm5" method="post">
				<input type="hidden" name="step" value="depositClear" />
			</form>


        </div>
        <!-- {/if} -->
        



		<!-- {if $step eq "depositConfirm"} -->
        <!-- 寄存成功 -->  
        <div class="block">
		<DIV class="w w1 header clearfix">
		
			<DIV id=logo><A href="index.php">
				<IMG title=返回商城首页 alt=返回商城首页 src="themes/baian/images/ba_logo.png" width="267" ></A>
			</DIV>
		
			<DIV class=language><A onclick=toEnCart() href="javascript:void(0);"></A></DIV>
			<DIV class="progress clearfix">
				<UL class=progress-3>
					  <LI class=step-1><B></B>1.我的购物车 </LI>
					  <LI class=step-2><B style="background-position:0 -50px;"></B>2.填写核对订单信息 </LI>
					  <LI class=step-3 complete>3.成功提交订单 </LI>
				</UL>
			</DIV>
		</DIV>
		<div class="flowBox mod2">
			
		</div>
        </div>
        <!-- {/if} -->


        
		<!-- {if $step eq "test"} -->
            <!-- {foreach from=$testarr item=t name=tn} --> 
            {$t.gid}=={$t.c1}=={$t.c2}<br/>
            <!-- {/foreach} -->
        <!-- {/if} -->

		<!-- {if $step eq "perfect"} -->
        <!-- 完善身份信息 -->
        <div class="block">
		<div id="hd">
		<div class="wp2">
			<a href="/" class="logo l"><img src="images/logo.jpg" alt=""></a>
			<div class="hdr r">
				<ul class="ul-step">
					<li>1.我的购物车 ></li>
					<li class="on">2.确认订单信息 ></li>
					<li>3.提交订单 ></li>
				</ul>
			</div>
		</div>
	</div>
  <div class="c"></div>
		<div class="flowBox mod2">
			<form action="flow.php?step=perfectConfirm" id="perfectConfirmForm" name="perfectConfirmForm" method="post">
			<h6 style="text-align:left; margin-top:20px; border-bottom:#C91422 2px solid; padding-bottom:10px; height: auto;">
				手机号码：<input id="txtPhone" name="txtPhone" value="{$phone}" type="text" />&nbsp;&nbsp;&nbsp;身份证号码：<input id="txtIdCard" name="txtIdCard" value="{$idcard}" type="text" />
			</h6>
			<h6 style="text-align:center; margin-top:20px; padding-bottom:10px;">
				<input style="padding:2px 5px;" type="submit" value="完善身份信息" />
			</h6>
			</form>
		</div>
        </div>
        <!-- {/if} -->





         
         
         
         
         
        <!-- {if $step eq "login"} -->
		<script type="text/javascript" src="/js/utils.js"></script>
		<script type="text/javascript" src="/js/user.js"></script>
        <script type="text/javascript">
        {foreach from=$lang.flow_login_register item=item key=key}
          var {$key} = "{$item}";
        {/foreach}

        {literal}
        function checkLoginForm(frm) {
          if (Utils.isEmpty(frm.elements['username'].value)) {
            alert(username_not_null);
            return false;
          }

          if (Utils.isEmpty(frm.elements['password'].value)) {
            alert(password_not_null);
            return false;
          }

          return true;
        }

        function checkSignupForm(frm) {
          if (Utils.isEmpty(frm.elements['username'].value)) {
            alert(username_not_null);
            return false;
          }

          if (Utils.trim(frm.elements['username'].value).match(/^\s*$|^c:\\con\\con$|[%,\'\*\"\s\t\<\>\&\\]/))
          {
            alert(username_invalid);
            return false;
          }

          if (Utils.isEmpty(frm.elements['email'].value)) {
            alert(email_not_null);
            return false;
          }

          if (!Utils.isEmail(frm.elements['email'].value)) {
            alert(email_invalid);
            return false;
          }

          if (Utils.isEmpty(frm.elements['password'].value)) {
            alert(password_not_null);
            return false;
          }

          if (frm.elements['password'].value.length < 6) {
            alert(password_lt_six);
            return false;
          }

          if (frm.elements['password'].value != frm.elements['confirm_password'].value) {
            alert(password_not_same);
            return false;
          }
          return true;
        }
        {/literal}
        
        	$(function(){
            	$("#loginForm").validate({
            		rules: {
            			username: {
        					required: true
        				},
        				password: {
        					required: true
        				},
        			},
        			messages: {
        				username: {
        					required: "请输入账户名",
        				},
        				password: {
        					required: "请输入密码",
        				}
        			}
            	});	                	
            });
        	
        </script>
        <!-- 开始用户登录注册界面 -->
        
        <section id="main">

			<header id="head">
				<a href="" class="back-btn"></a>
				<h2>登录</h2>
			</header>
	
			<div class="login-reg-Box">
				<form name="loginForm" id="loginForm" action="flow.php?step=login" method="post">
					<dl class="dl-login-reg">
						<dd>
							<input  name="username" id="username" type="text" placeholder="手机号/邮箱" class="" />
						</dd>
						<dd>
							<input name="password" type="password" placeholder="密码"/>
						</dd>
						<!-- <dd>
							<input type="email" placeholder="验证码" style="width: 360px;">
							<span class="test-string"><img src="images/ma.jpg" alt=""><a href="">换一张</a></span>
						</dd> -->
						<dd>
							<input type="checkbox" name="remember" checked="checked" style="display: none;"/>
							<input name="act" type="hidden" value="signin" />
							<input type="submit" value="登录">
						</dd>
					</dl>
					
					<div class="login-help">
						<a href="/mobile/user.php?act=get_password" class="r">找回密码</a>
						<a href="/mobile/user.php?act=register">快速注册</a>
					</div>
	
					<h3 class="st2">用合作网站登录：</h3>
					<ul class="ul-login-way">
						<li><a href="/login">QQ</a></li>
						<li><a href="/login/xlweiboconnect">微博</a></li>
						<li><a href="/login/alipay">支付宝</a></li>
					</ul>
				</form>
			</div>
		</section>
	
      <form action="flow.php?step=login" method="post" name="formUser" id="registerForm" onsubmit="return checkSignupForm(this)" style="display:none;">
               <table width="98%" border="0" cellpadding="8" cellspacing="0" bgcolor="#ffffff" class="table">
                  <tr>
                    <td align="right" width="25%"><strong>{$lang.username}</strong></td>
                    <td><input name="username" type="text" class="inputBg" id="username" onblur="is_registered(this.value);" /><br />
		    <span id="username_notice" style="color:#DD0000"></span></td>
                  </tr>
                  <tr>
                    <td align="right"><strong>{$lang.email_address}</strong></td>
                    <td><input name="email" type="text" class="inputBg" id="email" onblur="checkEmail(this.value);" /><br />
		    <span id="email_notice" style="color:#DD0000"></span></td>
                  </tr>
                  <tr>
                    <td align="right"><strong>{$lang.password}</strong></td>
                    <td><input name="password" class="inputBg" type="password" id="password1" onblur="check_password(this.value);" onkeyup="checkIntensity(this.value)" /><br />
		    <span style="color:#DD0000" id="password_notice"></span></td>
                  </tr>
                  <tr>
                    <td align="right"><strong>{$lang.confirm_password}</strong></td>
                    <td><input name="confirm_password" class="inputBg" type="password" id="confirm_password" onblur="check_conform_password(this.value);" /><br />
		    <span style="color:#DD0000" id="conform_password_notice"></span></td>
                  </tr>
                  <!-- 判断是否启用验证码{if $enabled_register_captcha} -->
                  <tr>
                    <td align="right"><strong>{$lang.comment_captcha}:</strong></td>
                    <td><input type="text" size="8" name="captcha" class="inputBg" />
                    <img src="captcha.php?{$rand}" alt="captcha" style="vertical-align: middle;cursor: pointer;" onClick="this.src='captcha.php?'+Math.random()" /> </td>
                  </tr>
                  <!--{/if}-->
                  <tr>
                    <td colspan="2" align="center">
                        <input type="submit" name="Submit" class="bnt_blue_1" value="{$lang.forthwith_register}" />
                        <input name="act" type="hidden" value="signup" />
                    </td>
                  </tr>
                </table>
              </form>
           <!-- 结束用户登录注册界面 -->
        <!-- {/if} -->
    
    
        



	<div class="h20"></div>

<script language="javascript"> 
<!--
/*屏蔽所有的js错误*/
function killerrors() { 
return true; 
} 
window.onerror = killerrors; 
//-->
</script>
<script type="text/javascript" src="themes/baian/images/misc/lib/js/e/lib-v1.js"></script>
<script type="text/javascript">$("#store-selector").Jdropdown();</script>
<script type="text/javascript">$.jdCalcul([537]);</script>
<script type="text/javascript">pageConfig.FN_InitContrast();</script>


<script type="text/javascript" src="/themes/baian/js/jquery-validation/dist/jquery.validate.js"></script>
<script type="text/javascript" src="/themes/baian/js/jquery-validation/lib/jquery.form.js"></script>
<script type="text/javascript" src="/themes/baian/js/jquery-validation/dist/localization/messages_zh.js"></script>
<script type="text/javascript" src="/themes/baian/js/jquery-validation/jquery.validate.extend.js"></script>

<!-- <script type="text/javascript" src="themes/baian/images/misc/lib/js/e/wl.js"></script> -->
</div>
</body>
<script type="text/javascript">
var process_request = "{$lang.process_request}";
{foreach from=$lang.passport_js item=item key=key}
var {$key} = "{$item}";
{/foreach}
var username_exist = "{$lang.username_exist}";
var compare_no_goods = "{$lang.compare_no_goods}";
var btn_buy = "{$lang.btn_buy}";
var is_cancel = "{$lang.is_cancel}";
var select_spe = "{$lang.select_spe}";
</script>
<!-- 公用样式与脚本 -->
	<!-- #BeginLibraryItem "/library/page_common_footer.lbi" --><!-- #EndLibraryItem -->
</html>




